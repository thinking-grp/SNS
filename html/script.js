const firebaseConfig={apiKey:"AIzaSyCCw9vbQuF9CJzyvhfy__UDIGq9SQO0KA8",authDomain:"thinking-sns.firebaseapp.com",projectId:"thinking-sns",storageBucket:"thinking-sns.firebasestorage.app",messagingSenderId:"133464509665",appId:"1:133464509665:web:c0b8769832c1d56ef9bba0",measurementId:"G-WZCMJ4R2TF"};import{initializeApp}from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";import{getFirestore,collection,doc,setDoc,getDoc,getDocs,query,orderBy,limit,serverTimestamp,startAfter,updateDoc}from "https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js";import{getAuth,signInWithPopup,GoogleAuthProvider,signInWithEmailAndPassword,createUserWithEmailAndPassword,signOut}from "https://www.gstatic.com/firebasejs/9.9.3/firebase-auth.js";const app=initializeApp(firebaseConfig);const db=getFirestore(app);const auth=getAuth(app);const googleProvider=new GoogleAuthProvider();let lastVisible=null;let isLoading=!1;const REACTIONS=['‚ù§Ô∏è','üëè','ü§î','ü§ù','‚úÖ'];const dialog2=document.getElementById('dialog2');const dialog2Headline=dialog2.querySelector('div[slot="headline"]');const dialog2Content=dialog2.querySelector('form[slot="content"]');async function signInWithGoogle(){try{const result=await signInWithPopup(auth,googleProvider);const user=result.user;dialog2Headline.textContent='„É≠„Ç∞„Ç§„É≥ÊàêÂäü!';dialog2Content.textContent=`${user.displayName}„Åï„Çì„ÄÅ„Çà„ÅÜ„Åì„Åù!`;await dialog2.show();updateUIForAuthenticatedUser(user)}catch(error){console.error("Google„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº:",error);dialog2Headline.textContent='„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº';dialog2Content.textContent='„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';await dialog2.show()}};async function signInWithEmail(email,password){try{const userCredential=await signInWithEmailAndPassword(auth,email,password);const user=userCredential.user;dialog2Headline.textContent='„É≠„Ç∞„Ç§„É≥ÊàêÂäü!';dialog2Content.textContent=`${user.email}„Åß„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü„ÄÇ`;await dialog2.show();updateUIForAuthenticatedUser(user)}catch(error){console.error("„É°„Éº„É´„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº:",error);dialog2Headline.textContent='„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº';dialog2Content.textContent='„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ';await dialog2.show()}};async function registerWithEmail(email,password){try{const userCredential=await createUserWithEmailAndPassword(auth,email,password);const user=userCredential.user;dialog2Headline.textContent='ÁôªÈå≤ÊàêÂäü!';dialog2Content.textContent=`${user.email}„ÅßÊñ∞Ë¶èÁôªÈå≤„Åï„Çå„Åæ„Åó„Åü„ÄÇ`;await dialog2.show();updateUIForAuthenticatedUser(user)}catch(error){console.error("„É°„Éº„É´ÁôªÈå≤„Ç®„É©„Éº:",error);dialog2Headline.textContent='ÁôªÈå≤„Ç®„É©„Éº';dialog2Content.textContent='„É¶„Éº„Ç∂„ÉºÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';await dialog2.show()}};function signOutUser(){signOut(auth).then(()=>{updateUIForUnauthenticatedUser()}).catch((error)=>{console.error("„É≠„Ç∞„Ç¢„Ç¶„Éà„Ç®„É©„Éº:",error)})};auth.onAuthStateChanged((user)=>{const loginSection=document.getElementById('login-section');const userInfoSection=document.getElementById('user-info-section');const postSection=document.getElementById('post-section');if(user){if(loginSection)loginSection.style.display='none';if(userInfoSection)userInfoSection.style.display='block';if(postSection)postSection.style.display='block';const userInfoElement=document.getElementById('user-info');if(userInfoElement){userInfoElement.textContent=`„Çà„ÅÜ„Åì„Åù„ÄÅ${user.displayName || user.email}„Åï„Çì`}}else{if(loginSection)loginSection.style.display='block';if(userInfoSection)userInfoSection.style.display='none';if(postSection)postSection.style.display='none'}});function updateUIForUnauthenticatedUser(){const loginSection=document.getElementById('login-section');const userInfoSection=document.getElementById('user-info-section');const postSection=document.getElementById('post-section');if(loginSection&&userInfoSection&&postSection){loginSection.style.display='block';userInfoSection.style.display='none';postSection.style.display='none'}};function updatePlaceholder(){const textInput=document.getElementById("text");const isMini=document.getElementById("mini").checked;textInput.placeholder=isMini?"3ÊñáÂ≠ó„Åß„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ":"„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ";updatePreview()};async function handleReaction(docId,reaction){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const docRef=doc(collection(parentDocRef,'maintext'),docId);const docSnap=await getDoc(docRef);if(docSnap.exists()){const data=docSnap.data();let reactions=data.reactions||{};reactions[reaction]=(reactions[reaction]||0)+1;await updateDoc(docRef,{reactions});const reactionButton=document.querySelector(`#reaction-button-${docId}-${reaction}`);if(reactionButton){updateReactionButton(reactionButton,reactions[reaction],reaction,data.bg,data.color)}}}catch(error){console.error("„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Êõ¥Êñ∞„Ç®„É©„Éº:",error)}};function updateReactionButton(button,count,emoji,postBg,postColor){button.innerHTML=`${emoji}${count} <md-ripple></md-ripple>`;button.style.backgroundColor=postColor||"#ffffff";button.style.color=postBg||"#000000"};function createReactionButtons(docId,reactions={},postBg,postColor){const container=document.createElement('div');container.className='reaction-buttons';container.style.marginTop='8px';REACTIONS.forEach(reaction=>{const button=document.createElement('button');button.id=`reaction-button-${docId}-${reaction}`;button.className='reactionbtn';button.style.cursor='pointer';button.innerHTML=`${reaction}${reactions[reaction] || 0} <md-ripple></md-ripple>`;button.style.backgroundColor=postColor+"dd"||"#ffffff";button.style.color=postBg||"#000000";button.addEventListener('click',()=>handleReaction(docId,reaction));container.appendChild(button)});return container};function displayDelayedText(element,text,startTime){const currentTime=new Date().getTime();const elapsedTime=(currentTime-startTime)/1000;const charactersToShow=Math.floor(elapsedTime/20);if(charactersToShow>=text.length){element.textContent=text}else{element.textContent=text.substring(0,charactersToShow)+'‚ñÆ';requestAnimationFrame(()=>displayDelayedText(element,text,startTime))}};async function submitPost(){const text=document.getElementById("text").value;const bg=document.getElementById("bg").value;const color=document.getElementById("color").value;const isDelay=document.getElementById("delay").checked;const isMini=document.getElementById("mini").checked;if(!text){dialog2Headline.textContent='„Åô„Å£„Åã„Çâ„Åã„Çì!';dialog2Content.textContent='„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';await dialog2.show();return};if(isMini&&text.length!==3){dialog2Headline.textContent='3ÊñáÂ≠ó„Åß!';dialog2Content.textContent='„Éü„ÉãÊäïÁ®ø„Åß„ÅØ3ÊñáÂ≠ó„Åó„ÅãÊäïÁ®ø„Åß„Åç„Åæ„Åõ„Çì„ÄÇ';await dialog2.show();return};try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const collectionName=isMini?'minitext':'maintext';const subColRef=collection(parentDocRef,collectionName);const subDocRef=doc(subColRef);await setDoc(subDocRef,{text,bg,color,createdAt:serverTimestamp(),reactions:{},replies:{},delay:isDelay});document.getElementById("text").value="";document.getElementById("bg").value="#ffffff";document.getElementById("color").value="#000000";dialog2Headline.textContent='ÂÆå‰∫Ü!';dialog2Content.textContent='ÊäïÁ®ø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!';await dialog2.show();lastVisible=null;if(isMini){await displayMiniPosts()}else{await displayPosts()}}catch(error){console.error("ÊäïÁ®ø„Ç®„É©„Éº:",error);dialog2Headline.textContent='ÊäïÁ®ø„Ç®„É©„Éº';dialog2Content.textContent='ÊäïÁ®ø„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇË©≥„Åó„Åè„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';await dialog2.show()}};async function displayMiniPosts(){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const subColRef=collection(parentDocRef,'minitext');const q=query(subColRef,orderBy("createdAt","desc"),limit(13));const querySnapshot=await getDocs(q);const miniContainer=document.getElementById("miniPost");if(!miniContainer){console.error("miniPostË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return};miniContainer.innerHTML="";querySnapshot.forEach((doc)=>{const data=doc.data();const miniBox=document.createElement("div");miniBox.className="mini-post-box";miniBox.style.backgroundColor=data.bg||"#ffffff";miniBox.style.color=data.color||"#000000";miniBox.style.display="inline-block";miniBox.textContent=data.text;miniContainer.appendChild(miniBox)})}catch(error){console.error("„Éü„ÉãÊäïÁ®øÂèñÂæó„Ç®„É©„Éº:",error)}};async function handleReply(postId,replyText){if(!replyText){dialog2Headline.textContent='‰Ωï„ÇÇ„Å™„ÅÑ!';dialog2Content.textContent='Ëøî‰ø°„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';await dialog2.show();return};try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const postDocRef=doc(collection(parentDocRef,'maintext'),postId);const postSnap=await getDoc(postDocRef);if(postSnap.exists()){const data=postSnap.data();const replies=data.replies||{};const replyId=Math.random().toString(36).substring(2,15);replies[replyId]={text:replyText,createdAt:new Date().toISOString()};await updateDoc(postDocRef,{replies});dialog2Headline.textContent='ÂÆå‰∫Ü!';dialog2Content.textContent='Ëøî‰ø°„Åï„Çå„Åæ„Åó„Åü!';await dialog2.show();displayReplies(postId)}}catch(error){console.error("Ëøî‰ø°‰øùÂ≠ò„Ç®„É©„Éº:",error);dialog2Headline.textContent='Ëøî‰ø°‰øùÂ≠ò„Ç®„É©„Éº';dialog2Content.textContent='Ëøî‰ø°„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇË©≥„Åó„Åè„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';await dialog2.show()}};async function displayReplies(postId){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const postDocRef=doc(collection(parentDocRef,'maintext'),postId);const postSnap=await getDoc(postDocRef);if(postSnap.exists()){const data=postSnap.data();const replies=data.replies||{};const replyList=document.querySelector(`.reply-list[data-doc-id="${postId}"]`);replyList.innerHTML="";Object.entries(replies).forEach(([id,reply])=>{const replyBox=document.createElement("div");replyBox.className='reply-box';const replyText=document.createElement("div");replyText.className='reply-text';replyText.textContent=reply.text;replyBox.appendChild(replyText);const replyTime=document.createElement("div");replyTime.className='reply-time';replyTime.textContent=new Date(reply.createdAt).toLocaleString();replyBox.appendChild(replyTime);replyList.appendChild(replyBox)})}}catch(error){console.error("Ëøî‰ø°Ë°®Á§∫„Ç®„É©„Éº:",error);dialog2Headline.textContent='Ëøî‰ø°ÂèñÂæó„Ç®„É©„Éº';dialog2Content.textContent='Ëøî‰ø°„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇË©≥„Åó„Åè„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';await dialog2.show()}};async function displayPosts(loadMore=!1){if(isLoading)return;isLoading=!0;try{const loadMoreButton=document.getElementById("loadMoreButton");if(loadMoreButton){loadMoreButton.textContent="Ë™≠„ÅøËæº„Åø‰∏≠...";loadMoreButton.disabled=!0};
const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const subColRef=collection(parentDocRef,'maintext');let q;if(loadMore&&lastVisible){q=query(subColRef,orderBy("createdAt","desc"),startAfter(lastVisible),limit(7))}else{q=query(subColRef,orderBy("createdAt","desc"),limit(7))};const querySnapshot=await getDocs(q);const postContainer=document.getElementById("postList");if(!loadMore){postContainer.innerHTML=""};querySnapshot.forEach((doc)=>{const data=doc.data();const postId=doc.id;const postBox=document.createElement("div");postBox.className="post-box";postBox.style.backgroundColor=data.bg||"#ffffff";postBox.style.color=data.color||"#000000";const postText=document.createElement("div");postText.className="post-text";if(data.delay){postText.textContent="‚ñÆ";const createdAtTime=data.createdAt?.toDate().getTime()||new Date().getTime();displayDelayedText(postText,data.text||"„ÉÜ„Ç≠„Çπ„Éà„Å™„Åó",createdAtTime)}else{postText.textContent=data.text||"„ÉÜ„Ç≠„Çπ„Éà„Å™„Åó"};postBox.appendChild(postText);const reactionContainer=createReactionButtons(postId,data.reactions,data.bg,data.color);postBox.appendChild(reactionContainer);const repliesContainer=document.createElement("div");repliesContainer.className="replies-container";repliesContainer.style.marginTop="10px";const showRepliesButton=document.createElement("button");showRepliesButton.textContent="Ëøî‰ø°„ÇíË°®Á§∫";showRepliesButton.className="nobg";showRepliesButton.dataset.docId=postId;showRepliesButton.innerHTML="Ëøî‰ø°„ÇíË°®Á§∫ <md-ripple></md-ripple>";showRepliesButton.style.color=data.color||"#000000";const replyInput=document.createElement("div");replyInput.style.display="none";replyInput.className="reply-input-container";const replyText=document.createElement("input");replyText.type="text";replyText.className="replyinput";replyText.placeholder="Ëøî‰ø°„ÇíÂÖ•Âäõ";const submitReplyButton=document.createElement("button");submitReplyButton.className="replybtn";submitReplyButton.dataset.docId=postId;submitReplyButton.innerHTML="Ëøî‰ø° <md-ripple></md-ripple>";submitReplyButton.style.color=data.bg||"#fff";submitReplyButton.style.backgroundColor=data.color||"#000";submitReplyButton.addEventListener("click",()=>handleReply(postId,replyText.value));replyInput.appendChild(replyText);replyInput.appendChild(submitReplyButton);postBox.appendChild(replyInput);const replyList=document.createElement("div");replyList.className="reply-list";replyList.dataset.docId=postId;postBox.appendChild(replyList);postBox.appendChild(showRepliesButton);postContainer.appendChild(postBox);showRepliesButton.addEventListener("click",async()=>{replyInput.style.display=replyInput.style.display==="none"?"block":"none";await displayReplies(postId)})});const documents=querySnapshot.docs;lastVisible=documents[documents.length-1]||null;if(loadMoreButton){if(documents.length<7){loadMoreButton.style.display="none"}else{loadMoreButton.style.display="block";loadMoreButton.disabled=!1;loadMoreButton.innerHTML="„ÇÇ„Å£„Å®Ë™≠„ÅøËæº„ÇÄ <md-ripple></md-ripple>"}}}catch(error){console.error("„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:",error);dialog2Headline.textContent='„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº';dialog2Content.textContent='ÊäïÁ®ø„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇË©≥„Åó„Åè„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';await dialog2.show()}finally{isLoading=!1}};document.addEventListener('DOMContentLoaded',()=>{const radioButtons=document.querySelectorAll('input[name="texttype"]');radioButtons.forEach(button=>{button.addEventListener('change',updatePlaceholder)});const googleLoginBtn=document.getElementById('google-login-btn');const emailLoginBtn=document.getElementById('email-login-btn');const emailRegisterBtn=document.getElementById('email-register-btn');const logoutBtn=document.getElementById('logout-btn');if(googleLoginBtn){googleLoginBtn.addEventListener('click',signInWithGoogle)};if(emailLoginBtn){emailLoginBtn.addEventListener('click',()=>{const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;signInWithEmail(email,password)})};if(emailRegisterBtn){emailRegisterBtn.addEventListener('click',()=>{const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;registerWithEmail(email,password)})};if(logoutBtn){logoutBtn.addEventListener('click',signOutUser)};auth.onAuthStateChanged((user)=>{if(user){updateUIForAuthenticatedUser(user)}else{updateUIForUnauthenticatedUser()}});displayPosts();displayMiniPosts();updatePlaceholder();const submitButton=document.getElementById("submitButton");if(submitButton){submitButton.addEventListener("click",submitPost);submitButton.innerHTML="ÊäïÁ®ø <md-ripple></md-ripple>"};const loadMoreButton=document.getElementById("loadMoreButton");if(loadMoreButton){loadMoreButton.addEventListener("click",()=>displayPosts(!0));loadMoreButton.innerHTML="„ÇÇ„Å£„Å®Ë™≠„ÅøËæº„ÇÄ <md-ripple></md-ripple>"};updatePreview()});const bgColorPicker=document.getElementById('bg');const textColorPicker=document.getElementById('color');const bgBox=document.getElementById('bgBox');const textBox=document.getElementById('textBox');const text=document.getElementById('text');bgColorPicker.addEventListener('input',updatePreview);textColorPicker.addEventListener('input',updatePreview);function updatePreview(){bgBox.style.backgroundColor=bgColorPicker.value;textBox.style.backgroundColor=textColorPicker.value;text.style.backgroundColor=bgColorPicker.value+"aa";text.style.color=textColorPicker.value};const elementA=document.querySelector('#text');const elementB=document.querySelector('.menu-container');if(elementA&&elementB){elementA.addEventListener('focus',()=>{elementB.style.right='calc(50vw + 310px)'});elementA.addEventListener('blur',()=>{elementB.style.right='calc(50vw + 260px)'})}const openDialogButton=document.getElementById('openDialogButton');const dialog=document.getElementById('myDialog');openDialogButton.addEventListener('click',async()=>{await dialog.show()});export{submitPost,displayPosts,displayMiniPosts}
